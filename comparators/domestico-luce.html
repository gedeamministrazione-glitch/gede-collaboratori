<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comparatore Offerte Luce Domestico</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f8f8f8; color: #333; line-height: 1.6; }
    h1 { text-align: center; color: #444; margin-bottom: 30px; }
    .input-section, .results-section { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; max-width: 900px; margin-left: auto; margin-right: auto; }
    .input-group { margin-bottom: 18px; }
    .input-group label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
    .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
    button { display: block; width: 100%; background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; font-size: 1.1rem; margin-top: 20px; }
    button:hover { background-color: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f2f2f2; font-weight: bold; color: #333; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #e9e9e9; }
    .print-button { display: block; width: auto; margin: 20px auto; padding: 10px 15px; background-color: #6c757d; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 1rem; text-align: center; }
    .print-button:hover { background-color: #5a6268; }
    #footer { text-align: center; padding-top: 20px; margin-top: 30px; border-top: 1px solid #ccc; color: #777; font-size: 0.9rem; }
    .note { font-size: 0.95rem; color: #666; margin-top: 10px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:0.85rem; margin-left:6px; }
    .section-title { text-align: center; color: #007bff; margin-top: 24px; margin-bottom: 6px; font-weight: 700; font-size: 1.05rem; }
    .validita { font-size: 0.82rem; color: #888; margin-left: 8px; }
  </style>
</head>
<body>
  <div id="header">
    <h1>GEDE SERVIZI - Offerte Luce Domestico</h1>
  </div>

  <div class="input-section">
    <h2>Inserisci i tuoi dati di consumo</h2>
    <div class="input-group">
      <label for="consumo">Consumo mensile (kWh):</label>
      <input type="number" id="consumo" value="225" step="0.01" min="0">
    </div>
    <div class="input-group">
      <label for="pun">PUN (â‚¬/kWh) <span class="badge">puro</span>:</label>
      <input type="number" id="pun" value="0.12" step="0.001" min="0">
    </div>
    <p class="note">
      Nota: il PUN inserito Ã¨ considerato <b>puro</b> (senza perdite).
      Le offerte indicizzate applicano perdite <b>Ã—1,10</b> (BT domestico). Valori <b>IVA e imposte escluse</b>.
      Il valore PUN dicembre 2025 era circa 0,1243 â‚¬/kWh monorario.
    </p>
    <button onclick="calcolaTutteLeOfferteLuce()">Calcola Offerte</button>
  </div>

  <div class="results-section">
    <h2 id="results-title">Risultati Comparazione Mensile Stimata</h2>

    <!-- CEI -->
    <div class="section-title">ðŸ”µ CEI â€“ Compagnia Energetica Italiana <span class="validita">(valide fino 31/03/2026)</span></div>
    <table id="tabella-cei">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili Vendita (â‚¬)</th>
          <th>Totale stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- ESTRA -->
    <div class="section-title">ðŸŸ  Estra</div>
    <table id="tabella-estra">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili Vendita (â‚¬)</th>
          <th>Totale stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- SINERGY -->
    <div class="section-title">ðŸŸ¢ Sinergy Luce e Gas <span class="validita">(valide fino 31/03/2026)</span></div>
    <table id="tabella-sinergy">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili Vendita (â‚¬)</th>
          <th>Totale stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="window.print()" class="print-button">Stampa Risultati</button>

    <div class="note" style="margin-top:14px;">
      Nota: i totali includono solo i costi di vendita (Materia Prima, Quota Fissa, componenti variabili di vendita).
      Sono esclusi IVA, imposte, costi di Rete e Oneri di Sistema ARERA.
      Sinergy: il costo di 50â‚¬/POD per prestazioni di connessione (voltura, subentro, ecc.) non Ã¨ incluso.
    </div>
  </div>

  <div id="footer">
    <p>&copy; 2025 GEDE SERVIZI. Tutti i diritti riservati.</p>
  </div>

  <script>
    // Perdite rete BT domestico
    const LOSS_BT = 1.10;

    // Dispacciamento + CapacitÃ  (da CTE CEI aggiornate)
    // Dispacciamento: 0,010780 â‚¬/kWh (TIDE, aggiornato Q1 2025)
    // CapacitÃ  (CrA): 0,008189 â‚¬/kWh (aggiornato dic 2025)
    const CEI_DISP  = 0.010780;
    const CEI_CAPA  = 0.008189;

    // Estra (stesso sistema)
    const ESTRA_DISP = 0.01078;
    const ESTRA_CAPA = 0.009008;

    // Sinergy (da CTE: dispacciamento complessivo 0,013580 â‚¬/kWh aggiornato 08/01/2026)
    const SINERGY_DISP = 0.013580;

    const round2 = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

    function makeRow(nome, costoMP, quotaFissa, costiVar) {
      const totale = costoMP + quotaFissa + costiVar;
      return {
        nome,
        costoMP:   round2(costoMP).toFixed(2),
        quotaFissa: round2(quotaFissa).toFixed(2),
        costiVar:  round2(costiVar).toFixed(2),
        totale:    round2(totale).toFixed(2)
      };
    }

    // =========================
    // CEI â€“ DOMESTICO LUCE
    // CTE valide fino al 31/03/2026
    // Spread = 0 su tutte e tre le offerte
    // PUN con perdite Ã—1,10
    // Dispacciamento (TIDE) 0,010780 â‚¬/kWh
    // CrA (capacitÃ ) 0,008189 â‚¬/kWh
    // CcP 0,00145 â‚¬/kWh  |  CsP 0,009 â‚¬/kWh  |  CrA vendita 0,00219 â‚¬/kWh
    // =========================

    // CEI GO: quota fissa 12 â‚¬/mese
    function calcolaCeiGo(consumo, pun) {
      const punEff    = pun * LOSS_BT;
      const spread    = 0.00;
      const quotaFissa = 12.00;
      // variabili: CcP 0,00145 + CrA 0,00219 + CsP 0,009 + dispacciamento + capacitÃ 
      const varKwh    = 0.00145 + 0.00219 + 0.009 + CEI_DISP + CEI_CAPA;

      const costoMP  = consumo * (punEff + spread);
      const costiVar = consumo * varKwh;
      return makeRow("CEI Go Luce", costoMP, quotaFissa, costiVar);
    }

    // CEI BOOST: quota fissa 15 â‚¬/mese
    function calcolaCeiBoost(consumo, pun) {
      const punEff    = pun * LOSS_BT;
      const spread    = 0.00;
      const quotaFissa = 15.00;
      const varKwh    = 0.00145 + 0.00219 + 0.009 + CEI_DISP + CEI_CAPA;

      const costoMP  = consumo * (punEff + spread);
      const costiVar = consumo * varKwh;
      return makeRow("CEI Boost Luce", costoMP, quotaFissa, costiVar);
    }

    // CEI TURBO: quota fissa 20 â‚¬/mese
    function calcolaCeiTurbo(consumo, pun) {
      const punEff    = pun * LOSS_BT;
      const spread    = 0.00;
      const quotaFissa = 20.00;
      const varKwh    = 0.00145 + 0.00219 + 0.009 + CEI_DISP + CEI_CAPA;

      const costoMP  = consumo * (punEff + spread);
      const costiVar = consumo * varKwh;
      return makeRow("CEI Turbo Luce", costoMP, quotaFissa, costiVar);
    }

    // =========================
    // ESTRA â€“ DOMESTICO LUCE (invariato)
    // =========================
    function calcolaEstraFissa(consumo, pun) {
      const prezzoFisso = 0.1507;
      const quotaFissa  = 132 / 12;
      const varKwh      = ESTRA_DISP + ESTRA_CAPA;
      const scontoMensile = 2.00;

      const costoMP  = consumo * (prezzoFisso + varKwh);
      const costiVar = -scontoMensile; // sconto SDD
      return makeRow("Estra Fissa Luce (sconto -2â‚¬/mese SDD)", costoMP, quotaFissa, costiVar);
    }

    function calcolaEstraNatura(consumo, pun) {
      const spread    = 0.0319;
      const punEff    = pun * LOSS_BT;
      const quotaFissa = 132 / 12;
      const varKwh    = ESTRA_DISP + ESTRA_CAPA;
      const scontoMensile = 2.00;

      const costoMP  = consumo * (punEff + spread + varKwh);
      const costiVar = -scontoMensile;
      return makeRow("Estra Natura Luce (sconto -2â‚¬/mese SDD)", costoMP, quotaFissa, costiVar);
    }

    // =========================
    // SINERGY â€“ FAMILY LUCE DOMESTICO
    // CTE 025867ESVFL03XX0000000325SHEDPUN â€” valida fino 31/03/2026
    // Variabile: PUNÃ—1,10 + 0,022 â‚¬/kWh (spread); quota fissa 96+24=120â‚¬/anno=10â‚¬/mese
    // Sbilanciamento: 0,005 â‚¬/kWh
    // Dispacciamento complessivo: 0,013580 â‚¬/kWh
    //
    // CTE 025867ESFFL01XX000000000126FIXED â€” valida fino 28/02/2026
    // Fissa: 0,1419 â‚¬/kWh (giÃ  al lordo perdite); quota fissa 156+36=192â‚¬/anno=16â‚¬/mese
    // =========================

    function calcolaSinergyFamilyLuceVariabile(consumo, pun) {
      const spread    = 0.022;
      const punEff    = pun * LOSS_BT;
      const quotaFissa = (96 + 24) / 12;  // 10 â‚¬/mese
      // variabili: sbilanciamento 0,005 + dispacciamento 0,013580
      const varKwh    = 0.005 + SINERGY_DISP;

      const costoMP  = consumo * (punEff + spread);
      const costiVar = consumo * varKwh;
      return makeRow("Sinergy Family Luce Variabile (PUNÃ—1,10 + 0,022)", costoMP, quotaFissa, costiVar);
    }

    function calcolaSinergyFamilyLuceFissa(consumo) {
      // Prezzo giÃ  al lordo perdite come da CTE
      const prezzoFisso = 0.1419;
      const quotaFissa  = (156 + 36) / 12;  // 16 â‚¬/mese
      // dispacciamento aggiornato 02/02/2026: 0,011641 â‚¬/kWh (da CTE fixed)
      const varKwh = 0.011641;

      const costoMP  = consumo * prezzoFisso;
      const costiVar = consumo * varKwh;
      return makeRow("Sinergy Family Luce Fisso (0,1419 â‚¬/kWh) âš ï¸ scade 28/02/2026", costoMP, quotaFissa, costiVar);
    }

    // =========================
    // RENDER
    // =========================
    function renderTabella(id, righe) {
      const tbody = document.querySelector('#' + id + ' tbody');
      tbody.innerHTML = '';
      righe.forEach(o => {
        const tr = tbody.insertRow();
        tr.insertCell(0).textContent = o.nome;
        tr.insertCell(1).textContent = 'â‚¬ ' + o.costoMP;
        tr.insertCell(2).textContent = 'â‚¬ ' + o.quotaFissa;
        tr.insertCell(3).textContent = 'â‚¬ ' + o.costiVar;
        tr.insertCell(4).textContent = 'â‚¬ ' + o.totale;
      });
    }

    function calcolaTutteLeOfferteLuce() {
      const consumo = parseFloat(document.getElementById('consumo').value) || 0;
      const pun     = parseFloat(document.getElementById('pun').value) || 0;

      if (Number.isNaN(consumo) || consumo < 0) { alert("Inserisci un consumo valido."); return; }
      if (Number.isNaN(pun) || pun < 0)         { alert("Inserisci un PUN valido."); return; }

      renderTabella('tabella-cei', [
        calcolaCeiGo(consumo, pun),
        calcolaCeiBoost(consumo, pun),
        calcolaCeiTurbo(consumo, pun),
      ]);

      renderTabella('tabella-estra', [
        calcolaEstraFissa(consumo, pun),
        calcolaEstraNatura(consumo, pun),
      ]);

      renderTabella('tabella-sinergy', [
        calcolaSinergyFamilyLuceVariabile(consumo, pun),
        calcolaSinergyFamilyLuceFissa(consumo),
      ]);
    }

    window.onload = calcolaTutteLeOfferteLuce;
  </script>
</body>
</html>
