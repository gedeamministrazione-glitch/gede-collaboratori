
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comparatore Offerte Luce Domestico</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f8f8f8; color: #333; line-height: 1.6; }
    h1 { text-align: center; color: #444; margin-bottom: 30px; }
    .input-section, .results-section { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; max-width: 700px; margin-left: auto; margin-right: auto; }
    .input-group { margin-bottom: 18px; }
    .input-group label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
    .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
    button { display: block; width: 100%; background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; font-size: 1.1rem; margin-top: 20px; }
    button:hover { background-color: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f2f2f2; font-weight: bold; color: #333; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #e9e9e9; }
    .print-button { display: block; width: auto; margin: 20px auto; padding: 10px 15px; background-color: #6c757d; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 1rem; text-align: center; }
    .print-button:hover { background-color: #5a6268; }
    #footer { text-align: center; padding-top: 20px; margin-top: 30px; border-top: 1px solid #ccc; color: #777; font-size: 0.9rem; }
    .note { font-size: 0.95rem; color: #666; margin-top: 10px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:0.85rem; margin-left:6px; }
  </style>
</head>
<body>
  <div id="header">
    <h1>GEDE SERVIZI - Offerte Luce Domestico</h1>
  </div>

  <div class="input-section">
    <h2>Inserisci i tuoi dati di consumo</h2>
    <div class="input-group">
      <label for="consumo">Consumo mensile (kWh):</label>
      <input type="number" id="consumo" value="225" step="0.01" min="0">
    </div>
    <div class="input-group">
      <label for="pun">PUN (€/kWh) <span class="badge">puro</span>:</label>
      <input type="number" id="pun" value="0.12" step="0.001" min="0">
    </div>
    <p class="note">
      Nota: il PUN inserito è considerato <b>puro</b> (senza perdite). Le offerte indicizzate che prevedono perdite applicano <b>×1,10</b>.
    </p>
    <button onclick="calcolaTutteLeOfferteLuce()">Calcola Offerte</button>
  </div>

  <div class="results-section">
    <h2 id="results-title">Risultati Comparazione Mensile Stimata</h2>
    <table id="risultati-tabella-luce">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (€)</th>
          <th>Costi di Commercializzazione (€)</th>
          <th>Sconti/Bonus (€)</th>
          <th>Totale stimato (€)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="window.print()" class="print-button">Stampa Risultati</button>
  </div>

  <div id="footer">
    <p>&copy; 2025 GEDE SERVIZI. Tutti i diritti riservati.</p>
  </div>

  <script>
    /***************************************************************
     * IMPOSTAZIONI GENERALI
     ***************************************************************/
    // Perdite rete BT (se PUN è "puro")
    const LOSS_MULTIPLIER_BT = 1.10;

    // Helper: arrotondamento 2 decimali come number
    const round2 = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

    function makeResult(nome, costoMateriaPrima, costiComm, sconto) {
      const totale = costoMateriaPrima + costiComm - sconto;
      return {
        nome,
        costoMateriaPrima: round2(costoMateriaPrima).toFixed(2),
        costiCommercializzazione: round2(costiComm).toFixed(2),
        sconti: (-round2(sconto)).toFixed(2),
        totale: round2(totale).toFixed(2)
      };
    }

    /***************************************************************
     * PARAMETRI "ARERA / SISTEMA" (valori che cambiano nel tempo)
     * In questo file li lasciamo fissi come da CTE caricate.
     ***************************************************************/

    // ESTRA (valori indicati nelle tue nuove CTE)
    const ESTRA_DISP_KWH = 0.01078;
    const ESTRA_CAPACITA_KWH = 0.009008;

    // CEI (valori indicati nelle tue nuove CTE)
    const CEI_DISP_KWH = 0.010780;
    const CEI_CAPACITA_KWH = 0.008189;

    /***************************************************************
     * OFFERTA: ESTRA FISSA LUCE (nuove CTE)
     ***************************************************************/
    function calcolaEstraFissa(consumoKwh, punPuro) {
      // Prezzo fisso energia (€/kWh) – già al lordo delle perdite secondo CTE
      const prezzoEnergiaFisso = 0.1507;

      // Componenti aggiuntive in quota energia
      const prezzoKwhTot =
        prezzoEnergiaFisso +
        ESTRA_DISP_KWH +
        ESTRA_CAPACITA_KWH;

      const costoMateriaPrima = consumoKwh * prezzoKwhTot;

      // PCV/Commercializzazione: 132 €/anno
      const costiComm = 132 / 12;

      // Sconto SDD: 24 €/anno -> 2 €/mese
      const sconto = 2.00;

      return makeResult("Estra Fissa Luce", costoMateriaPrima, costiComm, sconto);
    }

    /***************************************************************
     * OFFERTA: ESTRA NATURA LUCE (nuove CTE)
     ***************************************************************/
    function calcolaEstraNatura(consumoKwh, punPuro) {
      // Prezzo energia: PUN * 1,10 + spread
      const spread = 0.0319;

      const prezzoKwhTot =
        (punPuro * LOSS_MULTIPLIER_BT) +
        spread +
        ESTRA_DISP_KWH +
        ESTRA_CAPACITA_KWH;

      const costoMateriaPrima = consumoKwh * prezzoKwhTot;

      // PCV/Commercializzazione: 132 €/anno
      const costiComm = 132 / 12;

      // Sconto SDD: 2 €/mese
      const sconto = 2.00;

      return makeResult("Estra Natura Luce", costoMateriaPrima, costiComm, sconto);
    }

    /***************************************************************
     * OFFERTE: CEI (GO / BOOST / TURBO) (nuove CTE)
     * Struttura:
     * - Energia: PUN * 1,10 (perdite)
     * - + dispacciamento
     * - + mercato capacità
     * - + componenti variabili specifiche (CcP/CsP/CrA/altre)
     * - Quote fisse mensili specifiche
     ***************************************************************/
    function calcolaCeiBase(consumoKwh, punPuro, nome, quotaFissaMensile, extraVariabiliKwh) {
      const prezzoKwhTot =
        (punPuro * LOSS_MULTIPLIER_BT) +
        CEI_DISP_KWH +
        CEI_CAPACITA_KWH +
        extraVariabiliKwh;

      const costoMateriaPrima = consumoKwh * prezzoKwhTot;

      const costiComm = quotaFissaMensile;
      const sconto = 0.00;

      return makeResult(nome, costoMateriaPrima, costiComm, sconto);
    }

    function calcolaCeiGo(consumoKwh, punPuro) {
      // Fissi: 5,5 + 8 = 13,5 €/mese
      const fissi = 5.5 + 8;

      // Variabili: CsP 0,0095 + CrA 0,00235
      const extra = 0.0095 + 0.00235;

      return calcolaCeiBase(consumoKwh, punPuro, "CEI Go Luce", fissi, extra);
    }

    function calcolaCeiBoost(consumoKwh, punPuro) {
      // Fissi: 7 + 8,5 = 15,5 €/mese
      const fissi = 7 + 8.5;

      // Variabili: CcP 0,00219 + CrA 0,00235 + CsP 0,0095
      const extra = 0.00219 + 0.00235 + 0.0095;

      return calcolaCeiBase(consumoKwh, punPuro, "CEI Boost Luce", fissi, extra);
    }

    function calcolaCeiTurbo(consumoKwh, punPuro) {
      // Fissi: 12 + 10 = 22 €/mese
      const fissi = 12 + 10;

      // Variabili: 0,003 + CcP 0,00219 + CrA 0,00235 + CsP 0,0095
      const extra = 0.003 + 0.00219 + 0.00235 + 0.0095;

      return calcolaCeiBase(consumoKwh, punPuro, "CEI Turbo Luce", fissi, extra);
    }

    /***************************************************************
     * CALCOLO TOTALE + RENDER TABELLA
     ***************************************************************/
    function calcolaTutteLeOfferteLuce() {
      const consumo = parseFloat(document.getElementById('consumo').value);
      const pun = parseFloat(document.getElementById('pun').value);

      if (Number.isNaN(consumo) || consumo < 0) {
        alert("Inserisci un consumo mensile valido (kWh).");
        return;
      }
      if (Number.isNaN(pun) || pun < 0) {
        alert("Inserisci un PUN valido (€/kWh).");
        return;
      }

      const offerte = [
        calcolaEstraFissa(consumo, pun),
        calcolaEstraNatura(consumo, pun),
        calcolaCeiTurbo(consumo, pun),
        calcolaCeiBoost(consumo, pun),
        calcolaCeiGo(consumo, pun)
      ];

      const tabellaBody = document
        .getElementById('risultati-tabella-luce')
        .getElementsByTagName('tbody')[0];

      tabellaBody.innerHTML = '';

      offerte.forEach(offerta => {
        const row = tabellaBody.insertRow();
        row.insertCell(0).textContent = offerta.nome;
        row.insertCell(1).textContent = `€${offerta.costoMateriaPrima}`;
        row.insertCell(2).textContent = `€${offerta.costiCommercializzazione}`;
        row.insertCell(3).textContent = `€${offerta.sconti}`;
        row.insertCell(4).textContent = `€${offerta.totale}`;
      });
    }

    window.onload = calcolaTutteLeOfferteLuce;
  </script>
</body>
</html>

