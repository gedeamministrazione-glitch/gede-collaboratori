<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comparatore Offerte Gas Business</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f8f8f8; color: #333; line-height: 1.6; }
    h1 { text-align: center; color: #444; margin-bottom: 18px; }
    .input-section, .results-section { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); margin-bottom: 20px; max-width: 1000px; margin-left: auto; margin-right: auto; }
    .input-group { margin-bottom: 12px; }
    .input-group label { display: block; margin-bottom: 6px; color: #555; font-weight: 600; }
    .input-group input[type="number"], .input-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
    button.primary { display: inline-block; background-color: #007bff; color: white; padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; }
    button.primary:hover { background-color: #0056b3; }
    .section-title { text-align: center; color: #007bff; margin-top: 18px; margin-bottom: 8px; font-weight: 700; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; overflow-x: auto; }
    th, td { border: 1px solid #e2e6ea; padding: 10px; text-align: left; font-size: 0.93rem; }
    th { background: #f4f8ff; font-weight: 700; color: #223; }
    tr:nth-child(even) { background: #fbfbfb; }
    tr:hover { background: #f1f7ff; }
    .best { background-color: #e6ffe6 !important; font-weight: bold; }
    .saving-pos { color: #1a7a1a; font-weight: bold; }
    .saving-neg { color: #cc0000; font-weight: bold; }
    .small-note { font-size: 0.88rem; color: #666; margin-top: 12px; }
    .print-button { display:block; width:auto; margin: 14px auto 6px; padding: 8px 12px; background:#6c757d; color:#fff; border-radius:6px; border:none; cursor:pointer; }
    #footer { text-align:center; color:#777; font-size:0.9rem; margin-top:18px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:0.85rem; margin-left:6px; }
    .validita { font-size: 0.82rem; color: #888; margin-left: 8px; font-weight: normal; }
    .ref-box { background:#fff8e1; border:1px solid #ffe082; border-radius:6px; padding:12px 18px; margin-bottom:18px; font-size:0.95rem; }
    .ref-box strong { color:#b45309; }
    .periodo-badge { display:inline-block; padding:3px 12px; border-radius:999px; font-size:0.85rem; font-weight:700; margin-left:8px; }
    .periodo-mensile { background:#dbeafe; color:#1e40af; }
    .periodo-bimestrale { background:#fce7f3; color:#9d174d; }
    @media (max-width:700px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>GEDE SERVIZI - Comparatore Offerte Gas Business</h1>

  <div class="input-section">
    <h2 style="margin-top:0">Inserisci i tuoi dati di consumo</h2>
    <div class="grid">
      <div class="input-group">
        <label for="periodo">Tipo di bolletta:</label>
        <select id="periodo" onchange="aggiornaPeriodo()">
          <option value="1">Mensile</option>
          <option value="2">Bimestrale</option>
        </select>
      </div>
      <div class="input-group">
        <label for="psv">Indice Gas (‚Ç¨/Smc) <span class="badge">PSV</span></label>
        <input type="number" id="psv" value="0.33" step="0.0001" min="0" />
      </div>
    </div>
    <div class="grid">
      <div class="input-group">
        <label for="consumo" id="consumo-label">Consumo mensile (Smc)</label>
        <input type="number" id="consumo" value="416.67" step="0.01" min="0" />
      </div>
      <div class="input-group">
        <label for="spesaAttuale" id="spesa-label">Spesa attuale vendita (‚Ç¨/mese) ‚Äî opzionale:</label>
        <input type="number" id="spesaAttuale" value="" step="0.01" min="0" placeholder="es. 180.00" />
      </div>
    </div>

    <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
      <button class="primary" onclick="calcolaTutteLeOfferteGasBusiness()">Calcola Offerte</button>
      <button class="print-button" onclick="window.print()">Stampa risultati</button>
    </div>

    <p class="small-note">
      PSV dicembre 2025 = 0,33 ‚Ç¨/Smc. Calcoli su base <span id="nota-periodo">mensile</span>, solo componente vendita.
      Valori <b>IVA e imposte escluse</b>. Non comprende trasporto, distribuzione e oneri di sistema ARERA.
    </p>
  </div>

  <div class="results-section">
    <h2>Risultati comparazione <span id="badge-periodo" class="periodo-badge periodo-mensile">Mensile</span></h2>
    <div id="ref-attuale" class="ref-box" style="display:none"></div>

    <h3 class="section-title">üîµ CEI &gt; 10.000 Smc/anno</h3>
    <table id="tabella-cei-superiore">
      <thead><tr>
        <th>Offerta</th><th>Costo Energia (‚Ç¨/periodo)</th><th>Quota Fissa (‚Ç¨/periodo)</th>
        <th id="th-sup-periodo">Totale Mese (‚Ç¨)</th><th>Totale Anno (‚Ç¨)</th><th>Risparmio vs attuale</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <h3 class="section-title">üîµ CEI &lt; 10.000 Smc/anno</h3>
    <table id="tabella-cei-inferiore">
      <thead><tr>
        <th>Offerta</th><th>Costo Energia (‚Ç¨/periodo)</th><th>Quota Fissa (‚Ç¨/periodo)</th>
        <th id="th-inf-periodo">Totale Mese (‚Ç¨)</th><th>Totale Anno (‚Ç¨)</th><th>Risparmio vs attuale</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <h3 class="section-title">üü† Estra Business Gas</h3>
    <table id="tabella-estra">
      <thead><tr>
        <th>Offerta</th><th>Costo Energia (‚Ç¨/periodo)</th><th>Quota Fissa (‚Ç¨/periodo)</th>
        <th id="th-estra-periodo">Totale Mese (‚Ç¨)</th><th>Totale Anno (‚Ç¨)</th><th>Risparmio vs attuale</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <h3 class="section-title">üü¢ Sinergy Business Gas <span class="validita">(valida fino 31/03/2026 ‚Äî cod. 025867GSVML03XX00000325SHGBPSVDA)</span></h3>
    <table id="tabella-sinergy">
      <thead><tr>
        <th>Offerta</th><th>Costo Energia (‚Ç¨/periodo)</th><th>Quota Fissa (‚Ç¨/periodo)</th>
        <th id="th-sinergy-periodo">Totale Mese (‚Ç¨)</th><th>Totale Anno (‚Ç¨)</th><th>Risparmio vs attuale</th>
      </tr></thead>
      <tbody></tbody>
    </table>

    <p class="small-note">
      Il risparmio % √® calcolato rispetto alla spesa attuale inserita.
      Non include trasporto, distribuzione, oneri di sistema ARERA. IVA e imposte escluse.
    </p>
  </div>

  <div id="footer"><p>&copy; 2025 GEDE SERVIZI ‚Äî valori stimati. Tutti i diritti riservati.</p></div>

  <script>
    const round2 = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

    function getPeriodo() { return parseInt(document.getElementById('periodo').value); }

    function aggiornaPeriodo() {
      const p = getPeriodo();
      const isBim = p === 2;
      const label = isBim ? 'bimestrale' : 'mensile';
      document.getElementById('consumo-label').textContent = 'Consumo ' + label + ' (Smc)';
      document.getElementById('spesa-label').textContent = 'Spesa attuale vendita (‚Ç¨/' + (isBim ? 'bimestre' : 'mese') + ') ‚Äî opzionale:';
      document.getElementById('nota-periodo').textContent = label;
      document.getElementById('badge-periodo').textContent = isBim ? 'Bimestrale' : 'Mensile';
      document.getElementById('badge-periodo').className = 'periodo-badge ' + (isBim ? 'periodo-bimestrale' : 'periodo-mensile');
      const thLabel = isBim ? 'Totale Bimestre (‚Ç¨)' : 'Totale Mese (‚Ç¨)';
      ['th-sup-periodo','th-inf-periodo','th-estra-periodo','th-sinergy-periodo'].forEach(id => {
        document.getElementById(id).textContent = thLabel;
      });
    }

    function makeOffer(nome, costoEnergia, quotaFissaMensile, sa, periodoMesi) {
      const qf = quotaFissaMensile * periodoMesi;
      const totPeriodo = costoEnergia + qf;
      const totAnno = totPeriodo * (12 / periodoMesi);
      let risparmioMese = null, risparmioPerc = null;
      if (sa > 0) {
        risparmioMese = sa - totPeriodo;
        risparmioPerc = (risparmioMese / sa) * 100;
      }
      return {
        nome,
        costoEnergia: round2(costoEnergia).toFixed(2),
        quotaFissa:   round2(qf).toFixed(2),
        totMese:      round2(totPeriodo).toFixed(2),
        totAnno:      round2(totAnno).toFixed(2),
        risparmioMese: risparmioMese !== null ? round2(risparmioMese).toFixed(2) : null,
        risparmioPerc: risparmioPerc !== null ? risparmioPerc.toFixed(1) : null
      };
    }

    const CEI_GT = { quotaFissa: 14.00, varUnit: 0.02 + 0.0219 + 0.0145, spreads: { PARTNER: 0.12, PRO: 0.10, FLEX: 0.08 } };

    // CEI SMART (da CTE): spread 0,055 ‚Ç¨/Smc; QF 4,9 ‚Ç¨/mese; varUnit = CV 0,02 + CcP 0,0219 + CrA 0,0145
    const CEI_GT_SMART = { spread: 0.055, quotaFissa: 4.90, varUnit: 0.02 + 0.0219 + 0.0145 };

    const CEI_LT = {
      REFLEX: { spread: 0.08, quotaFissa: 26.00, varUnit: 0.05 + 0.02 + 0.0219 + 0.0145 },
      CANON:  { spread: 0.08, quotaFissa: 19.50, varUnit: 0.02 + 0.0219 + 0.0145 + 0.03 },
      VISION: { spread: 0.09, quotaFissa: 15.00, varUnit: 0.02 + 0.0219 + 0.0145 }
    };

    function ceiGT(consumo, psv, nome, spread, sa, p) {
      const costoEnergia = consumo * (psv + spread + CEI_GT.varUnit);
      return makeOffer("CEI " + nome + " (>10k Smc)", costoEnergia, CEI_GT.quotaFissa, sa, p);
    }

    function ceiGTSmart(consumo, psv, sa, p) {
      const costoEnergia = consumo * (psv + CEI_GT_SMART.spread + CEI_GT_SMART.varUnit);
      return makeOffer("CEI Smart (>10k Smc)", costoEnergia, CEI_GT_SMART.quotaFissa, sa, p);
    }

    function ceiLT(consumo, psv, nome, cfg, sa, p) {
      const costoEnergia = consumo * (psv + cfg.spread + cfg.varUnit);
      return makeOffer("CEI " + nome + " (<10k Smc)", costoEnergia, cfg.quotaFissa, sa, p);
    }

    function calcolaEstraTrend(consumo, psv, sa, p) {
      const costoEnergia = consumo * (psv + 0.075);
      return makeOffer("Estra TREND Gas (variabile)", costoEnergia, 184.8/12, sa, p);
    }
    function calcolaEstraRelax(consumo, sa, p) {
      const costoEnergia = consumo * 0.409;
      return makeOffer("Estra RELAX Gas (fissa 0,409 ‚Ç¨/Smc)", costoEnergia, 184.8/12, sa, p);
    }
    function calcolaSinergyBusinessGas(consumo, psv, sa, p) {
      const costoEnergia = consumo * (psv + 0.170892);
      return makeOffer("Sinergy Business Gas (PSV + 0,170892)", costoEnergia, (120+24)/12, sa, p);
    }

    function renderTable(id, rows) {
      const tbody = document.querySelector('#' + id + ' tbody');
      tbody.innerHTML = "";
      const minTot = Math.min(...rows.map(o => parseFloat(o.totMese)));
      rows.forEach(o => {
        const isBest = parseFloat(o.totMese) === minTot;
        const row = document.createElement('tr');
        if (isBest) row.classList.add('best');
        let rispHtml = '<td>‚Äî</td>';
        if (o.risparmioMese !== null) {
          const v = parseFloat(o.risparmioMese);
          const p2 = parseFloat(o.risparmioPerc);
          const cls = v >= 0 ? 'saving-pos' : 'saving-neg';
          const absV = Math.abs(v).toFixed(2);
          const absP = Math.abs(p2).toFixed(1);
          rispHtml = `<td class="${cls}">${v >= 0 ? '‚ñº -' : '‚ñ≤ +'}‚Ç¨${absV}/periodo (${v >= 0 ? '-' : '+'}${absP}%)<br><small>${v >= 0 ? '‚ñº -' : '‚ñ≤ +'}‚Ç¨${(Math.abs(v)*(12/getPeriodo())).toFixed(2)}/anno</small></td>`;
        }
        row.innerHTML = `<td>${o.nome}${isBest ? ' ‚≠ê' : ''}</td><td>‚Ç¨ ${o.costoEnergia}</td><td>‚Ç¨ ${o.quotaFissa}</td><td>‚Ç¨ ${o.totMese}</td><td>‚Ç¨ ${o.totAnno}</td>${rispHtml}`;
        tbody.appendChild(row);
      });
    }

    function calcolaTutteLeOfferteGasBusiness() {
      const consumo = parseFloat(document.getElementById('consumo').value) || 0;
      const psv     = parseFloat(document.getElementById('psv').value) || 0;
      const sa      = parseFloat(document.getElementById('spesaAttuale').value) || 0;
      const p       = getPeriodo();

      const refBox = document.getElementById('ref-attuale');
      if (sa > 0) {
        const periodoLabel = p === 2 ? 'bimestrale' : 'mensile';
        refBox.style.display = 'block';
        refBox.innerHTML = `<strong>Spesa attuale di riferimento (${periodoLabel}):</strong> ‚Ç¨ ${sa.toFixed(2)} &nbsp;|&nbsp; <strong>Annuale:</strong> ‚Ç¨ ${(sa*(12/p)).toFixed(2)}`;
      } else { refBox.style.display = 'none'; }

      // CEI >10k: ordine richiesto: PARTNER, PRO, FLEX, SMART
      renderTable('tabella-cei-superiore', [
        ceiGT(consumo, psv, "Partner", CEI_GT.spreads.PARTNER, sa, p),
        ceiGT(consumo, psv, "Pro",     CEI_GT.spreads.PRO, sa, p),
        ceiGT(consumo, psv, "Flex",    CEI_GT.spreads.FLEX, sa, p),
        ceiGTSmart(consumo, psv, sa, p),
      ]);

      renderTable('tabella-cei-inferiore', [
        ceiLT(consumo, psv, "Reflex", CEI_LT.REFLEX, sa, p),
        ceiLT(consumo, psv, "Canon",  CEI_LT.CANON, sa, p),
        ceiLT(consumo, psv, "Vision", CEI_LT.VISION, sa, p),
      ]);

      renderTable('tabella-estra', [
        calcolaEstraTrend(consumo, psv, sa, p),
        calcolaEstraRelax(consumo, sa, p),
      ]);

      renderTable('tabella-sinergy', [
        calcolaSinergyBusinessGas(consumo, psv, sa, p),
      ]);
    }

    window.addEventListener('load', calcolaTutteLeOfferteGasBusiness);
  </script>
</body>
</html>
