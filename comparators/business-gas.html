<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comparatore Gas Business</title>
    <link rel="stylesheet" href="../styles.css" />
</head>

<body>
    <div class="container">
        <a href="../dashboard.html" class="back-button">← Torna alla Dashboard</a>
        <h1>Comparatore Gas Business</h1>

        <div class="form-container">
            <label for="consumo">Smc Mensili:</label>
            <input type="number" id="consumo" value="100" step="0.01" />

            <label for="psv">PSV (€/Smc):</label>
            <input type="number" id="psv" value="0.40" step="0.0001" />

            <button onclick="calcola()" class="btn-primary">Calcola</button>
        </div>

        <div class="results-container">
            <h2>Risultati</h2>

            <table>
                <thead>
                    <tr>
                        <th>Offerta</th>
                        <th>Materia Prima (€)</th>
                        <th>Quota Fissa (€)</th>
                        <th>Variabili (€)</th>
                        <th>Totale (€)</th>
                    </tr>
                </thead>
                <tbody id="tabella-risultati"></tbody>
            </table>
        </div>
    </div>

<script>
function fmt(n) {
    return parseFloat(n).toFixed(2);
}

// ====== OFFERTE CEI > 10.000 Smc ======
function calcolaCeiPartner(consumo, psv) {
    const spread = 0.120, quota = 14.00, variabili = 0.02 + 0.0219 + 0.0145;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Partner (> 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

function calcolaCeiPro(consumo, psv) {
    const spread = 0.100, quota = 14.00, variabili = 0.02 + 0.0219 + 0.0145;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Pro (> 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

function calcolaCeiFlex(consumo, psv) {
    const spread = 0.080, quota = 14.00, variabili = 0.02 + 0.0219 + 0.0145;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Flex (> 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

// ====== OFFERTE CEI < 10.000 Smc ======
function calcolaCeiReflex(consumo, psv) {
    const spread = 0.080, quota = 26.00, variabili = 0.05 + 0.02 + 0.0219 + 0.0145;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Reflex (< 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

function calcolaCeiCanon(consumo, psv) {
    const spread = 0.080, quota = 19.50, variabili = 0.02 + 0.0219 + 0.0145 + 0.03;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Canon (< 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

function calcolaCeiVision(consumo, psv) {
    const spread = 0.090, quota = 15.00, variabili = 0.02 + 0.0219 + 0.0145;
    const materia = consumo * (psv + spread);
    const varCosto = consumo * variabili;
    return {
        nome: "CEI Vision (< 10.000 Smc)",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: fmt(varCosto),
        totale: fmt(materia + quota + varCosto)
    };
}

// ====== OFFERTE ESTRA ======
function calcolaEstraVariabile(consumo, psv) {
    const spread = 0.10, quota = 12.00;
    const materia = consumo * (psv + spread);
    return {
        nome: "Estra Business Variabile",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: "0.00",
        totale: fmt(materia + quota)
    };
}

function calcolaEstraFissa(consumo) {
    const prezzo = 0.52, quota = 12.00;
    const materia = consumo * prezzo;
    return {
        nome: "Estra Business Fissa",
        materia: fmt(materia),
        quota: fmt(quota),
        variabile: "0.00",
        totale: fmt(materia + quota)
    };
}

// ====== CALCOLO GENERALE ======
function calcola() {
    const consumo = parseFloat(document.getElementById("consumo").value) || 0;
    const psv = parseFloat(document.getElementById("psv").value) || 0;

    const offerte = [
        calcolaCeiPartner(consumo, psv),
        calcolaCeiPro(consumo, psv),
        calcolaCeiFlex(consumo, psv),
        calcolaCeiReflex(consumo, psv),
        calcolaCeiCanon(consumo, psv),
        calcolaCeiVision(consumo, psv),
        calcolaEstraVariabile(consumo, psv),
        calcolaEstraFissa(consumo)
    ];

    const tbody = document.getElementById("tabella-risultati");
    tbody.innerHTML = "";

    offerte.forEach(o => {
        tbody.innerHTML += `
            <tr>
                <td>${o.nome}</td>
                <td>€ ${o.materia}</td>
                <td>€ ${o.quota}</td>
                <td>€ ${o.variabile}</td>
                <td>€ ${o.totale}</td>
            </tr>`;
    });
}

window.onload = calcola;
</script>

</body>
</html>
