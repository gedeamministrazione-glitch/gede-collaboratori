<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comparatore Offerte Gas Business</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f8f8f8; color: #333; line-height: 1.6; }
    h1 { text-align: center; color: #444; margin-bottom: 18px; }
    .input-section, .results-section { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); margin-bottom: 20px; max-width: 900px; margin-left: auto; margin-right: auto; }
    .input-group { margin-bottom: 12px; }
    .input-group label { display: block; margin-bottom: 6px; color: #555; font-weight: 600; }
    .input-group input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
    button.primary { display: inline-block; background-color: #007bff; color: white; padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; }
    button.primary:hover { background-color: #0056b3; }
    .section-title { text-align: center; color: #007bff; margin-top: 18px; margin-bottom: 8px; font-weight: 700; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #e2e6ea; padding: 10px; text-align: left; font-size: 0.95rem; }
    th { background: #f4f8ff; font-weight: 700; color: #223; }
    tr:nth-child(even) { background: #fbfbfb; }
    tr:hover { background: #f1f7ff; }
    .small-note { font-size: 0.9rem; color: #666; margin-top: 12px; }
    .print-button { display:block; width:auto; margin: 14px auto 6px; padding: 8px 12px; background:#6c757d; color:#fff; border-radius:6px; border:none; cursor:pointer; }
    #footer { text-align:center; color:#777; font-size:0.9rem; margin-top:18px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:0.85rem; margin-left:6px; }
    .validita { font-size: 0.82rem; color: #888; margin-left: 8px; font-weight: normal; }
    @media (max-width:700px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>GEDE SERVIZI - Comparatore Offerte Gas Business</h1>

  <div class="input-section">
    <h2 style="margin-top:0">Inserisci i tuoi dati di consumo</h2>
    <div class="grid">
      <div class="input-group">
        <label for="consumo">Consumo mensile (Smc)</label>
        <input type="number" id="consumo" value="416.67" step="0.01" min="0" />
      </div>
      <div class="input-group">
        <label for="psv">Indice Gas (â‚¬/Smc) <span class="badge">PSV</span></label>
        <input type="number" id="psv" value="0.33" step="0.0001" min="0" />
      </div>
    </div>

    <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
      <button class="primary" onclick="calcolaTutteLeOfferteGasBusiness()">Calcola Offerte</button>
      <button class="print-button" onclick="window.print()">Stampa risultati</button>
    </div>

    <p class="small-note">
      PSV dicembre 2025 = 0,33 â‚¬/Smc. Calcoli su base mensile, solo componente vendita.
      Valori <b>IVA e imposte escluse</b>. Non comprende trasporto, distribuzione e oneri di sistema ARERA.
    </p>
  </div>

  <div class="results-section">
    <h2>Risultati comparazione (stima mensile)</h2>

    <!-- CEI > 10.000 Smc -->
    <h3 class="section-title">ðŸ”µ CEI &gt; 10.000 Smc/anno</h3>
    <table id="tabella-cei-superiore">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili Vendita (â‚¬)</th>
          <th>Totale Stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- CEI < 10.000 Smc -->
    <h3 class="section-title">ðŸ”µ CEI &lt; 10.000 Smc/anno</h3>
    <table id="tabella-cei-inferiore">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili Vendita (â‚¬)</th>
          <th>Totale Stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- ESTRA -->
    <h3 class="section-title">ðŸŸ  Estra Business Gas</h3>
    <table id="tabella-estra">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili (â‚¬)</th>
          <th>Totale Stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- SINERGY -->
    <h3 class="section-title">ðŸŸ¢ Sinergy Business Gas <span class="validita">(valida fino 31/03/2026 â€” cod. 025867GSVML03XX00000325SHGBPSVDA)</span></h3>
    <table id="tabella-sinergy">
      <thead>
        <tr>
          <th>Offerta</th>
          <th>Costo Materia Prima (â‚¬)</th>
          <th>Quota Fissa (â‚¬/mese)</th>
          <th>Costi Variabili (â‚¬)</th>
          <th>Totale Stimato (â‚¬)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="footer">
    <p>&copy; 2025 GEDE SERVIZI â€” valori stimati. Tutti i diritti riservati.</p>
  </div>

  <script>
    function fmt2(n){ return (Math.round((n + Number.EPSILON) * 100) / 100).toFixed(2); }

    function makeOffer(nome, costoMP, quotaFissa, costiVar) {
      const totale = costoMP + quotaFissa + costiVar;
      return { nome, costoMP: fmt2(costoMP), quotaFissa: fmt2(quotaFissa), costiVar: fmt2(costiVar), totale: fmt2(totale) };
    }

    /***************************************************************
     * CEI > 10.000 Smc/anno
     * Spread: Partner 0,12 | Pro 0,10 | Flex 0,08
     * Quota fissa: 14 â‚¬/mese
     * Variabili: bilanciamento 0,02 + CrA 0,0219 + CcP 0,0145 = 0,0564 â‚¬/Smc
     ***************************************************************/
    const CEI_GT = {
      quotaFissa: 14.00,
      varUnit: 0.02 + 0.0219 + 0.0145,
      spreads: { PARTNER: 0.12, PRO: 0.10, FLEX: 0.08 }
    };

    function ceiGT(consumo, psv, nome, spread) {
      const costoMP  = consumo * (psv + spread);
      const costiVar = consumo * CEI_GT.varUnit;
      return makeOffer("CEI " + nome + " (>10k Smc)", costoMP, CEI_GT.quotaFissa, costiVar);
    }

    /***************************************************************
     * CEI < 10.000 Smc/anno
     ***************************************************************/
    const CEI_LT = {
      REFLEX: { spread: 0.08, quotaFissa: 26.00, varUnit: 0.05 + 0.02 + 0.0219 + 0.0145 },
      CANON:  { spread: 0.08, quotaFissa: 19.50, varUnit: 0.02 + 0.0219 + 0.0145 + 0.03 },
      VISION: { spread: 0.09, quotaFissa: 15.00, varUnit: 0.02 + 0.0219 + 0.0145 }
    };

    function ceiLT(consumo, psv, nome, cfg) {
      const costoMP  = consumo * (psv + cfg.spread);
      const costiVar = consumo * cfg.varUnit;
      return makeOffer("CEI " + nome + " (<10k Smc)", costoMP, cfg.quotaFissa, costiVar);
    }

    /***************************************************************
     * ESTRA BUSINESS GAS (invariato)
     ***************************************************************/
    function calcolaEstraTrend(consumo, psv) {
      const spread = 0.08;
      const quotaFissa = 168 / 12;
      const costoMP  = consumo * (psv + spread);
      const costiVar = 0;
      return makeOffer("Estra TREND Gas (variabile)", costoMP, quotaFissa, costiVar);
    }

    function calcolaEstraRelax(consumo) {
      const prezzoFisso = 0.409;
      const quotaFissa  = 168 / 12;
      const costoMP  = consumo * prezzoFisso;
      const costiVar = 0;
      return makeOffer("Estra RELAX Gas (fissa 0,409 â‚¬/Smc)", costoMP, quotaFissa, costiVar);
    }

    /***************************************************************
     * SINERGY BUSINESS GAS
     * CTE cod. 025867GSVML03XX00000325SHGBPSVDA â€” valida fino 31/03/2026
     * Materia prima: PSV + 0,120 â‚¬/Smc
     * Quota fissa: 120+24 = 144 â‚¬/anno = 12 â‚¬/mese
     * Bilanciamento Business: 0,020 â‚¬/Smc
     * (CCR sistema non indicato in questa CTE business)
     ***************************************************************/
    function calcolaSinergyBusinessGas(consumo, psv) {
      const spread    = 0.120;
      const quotaFissa = (120 + 24) / 12;  // 12 â‚¬/mese
      const varUnit   = 0.020;             // bilanciamento business

      const costoMP  = consumo * (psv + spread);
      const costiVar = consumo * varUnit;
      return makeOffer("Sinergy Business Gas (PSV + 0,12)", costoMP, quotaFissa, costiVar);
    }

    /***************************************************************
     * RENDER
     ***************************************************************/
    function renderTable(id, rows) {
      const tbody = document.querySelector('#' + id + ' tbody');
      tbody.innerHTML = "";
      rows.forEach(o => {
        tbody.innerHTML += `<tr>
          <td>${o.nome}</td>
          <td>â‚¬ ${o.costoMP}</td>
          <td>â‚¬ ${o.quotaFissa}</td>
          <td>â‚¬ ${o.costiVar}</td>
          <td>â‚¬ ${o.totale}</td>
        </tr>`;
      });
    }

    function calcolaTutteLeOfferteGasBusiness() {
      const consumo = parseFloat(document.getElementById('consumo').value) || 0;
      const psv     = parseFloat(document.getElementById('psv').value) || 0;

      renderTable('tabella-cei-superiore', [
        ceiGT(consumo, psv, "Partner", CEI_GT.spreads.PARTNER),
        ceiGT(consumo, psv, "Pro",     CEI_GT.spreads.PRO),
        ceiGT(consumo, psv, "Flex",    CEI_GT.spreads.FLEX),
      ]);

      renderTable('tabella-cei-inferiore', [
        ceiLT(consumo, psv, "Reflex", CEI_LT.REFLEX),
        ceiLT(consumo, psv, "Canon",  CEI_LT.CANON),
        ceiLT(consumo, psv, "Vision", CEI_LT.VISION),
      ]);

      renderTable('tabella-estra', [
        calcolaEstraTrend(consumo, psv),
        calcolaEstraRelax(consumo),
      ]);

      renderTable('tabella-sinergy', [
        calcolaSinergyBusinessGas(consumo, psv),
      ]);
    }

    window.addEventListener('load', calcolaTutteLeOfferteGasBusiness);
  </script>
</body>
</html>
